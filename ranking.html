<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>ğŸ† Ranking punktowy</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body {
  font-family: Arial, sans-serif;
  background:#111;
  color:#fff;
  padding:20px;
}
h1 { text-align:center; margin-bottom:10px; }
.points-info {
  text-align: center;
  background: #222;
  max-width: 600px;
  margin: 0 auto 20px auto;
  padding: 15px;
  border-radius: 8px;
  border: 1px dashed #555;
  color: #ffcc00;
  font-size: 0.9em;
}
table {
  width:100%;
  max-width:600px;
  margin:auto;
  border-collapse:collapse;
}
th,td {
  border:1px solid #444;
  padding:12px;
  text-align:center;
}
th { background:#222; }

.clear-btn {
  display: block;
  margin: 20px auto;
  padding: 10px 20px;
  background-color: #e74c3c;
  color: white;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  font-weight: bold;
}
.clear-btn:hover { background-color: #c0392b; }
</style>
</head>
<body>

<h1>ğŸ† Ranking punktowy</h1>

<div class="points-info">
  <strong>System punktacji:</strong><br>
  ğŸ¥‡ 1. miejsce: <b>3 pkt</b> | ğŸ¥ˆ 2. miejsce: <b>2 pkt</b> | ğŸ¥‰ 3. miejsce: <b>1 pkt</b>
</div>

<table id="rank">
<tr><th>#</th><th>ImiÄ™</th><th>Punkty</th></tr>
</table>

<button class="clear-btn" onclick="clearRanking()">ğŸ—‘ï¸ WyczyÅ›Ä‡ wszystko</button>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { 
  getFirestore, collection, onSnapshot, getDocs, deleteDoc, doc 
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCEEVCSx2uOOggu_4y_gUo4WMyKqf-HlKI",
  authDomain: "obstaiwanie.firebaseapp.com",
  projectId: "obstaiwanie"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const table = document.getElementById("rank");

onSnapshot(collection(db,"ranking"), snap=>{
  const data=[];
  snap.forEach(d => {
    const docData = d.data();
    
    // Obliczanie punktÃ³w na podstawie pÃ³l w Firebase
    // JeÅ›li pola nie istniejÄ…, przyjmujemy 0
    const p1 = docData.place1 || 0;
    const p2 = docData.place2 || 0;
    const p3 = docData.place3 || 0;
    
    const totalPoints = (p1 * 3) + (p2 * 2) + (p3 * 1);
    
    data.push({
      name: d.id, 
      points: totalPoints
    });
  });

  // Sortowanie po punktach malejÄ…co
  data.sort((a,b) => b.points - a.points);

  table.innerHTML="<tr><th>#</th><th>ImiÄ™</th><th>Suma PunktÃ³w</th></tr>";
  data.forEach((u,i)=>{
    table.innerHTML+=`
      <tr>
        <td>${i+1}</td>
        <td>${u.name}</td>
        <td><strong>${u.points}</strong></td>
      </tr>`;
  });
});

window.clearRanking = async () => {
  if (confirm("Czy na pewno chcesz wyczyÅ›ciÄ‡ wszystkie dane?")) {
    try {
      const querySnapshot = await getDocs(collection(db, "ranking"));
      const deletePromises = querySnapshot.docs.map(d => deleteDoc(doc(db, "ranking", d.id)));
      await Promise.all(deletePromises);
      alert("Dane zostaÅ‚y usuniÄ™te.");
    } catch (e) {
      alert("BÅ‚Ä…d: " + e.message);
    }
  }
};
</script>

</body>
</html>
