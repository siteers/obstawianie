<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>Lista u≈ºytkownik√≥w</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
    body {
        font-family: Arial, sans-serif;
        background: #f2f2f2;
        margin: 0;
        padding: 20px;
        display: flex;
        justify-content: center;
        transition: background-color 0.2s;
    }

    .container {
        max-width: 1100px;
        width: 100%;
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 0 20px rgba(0,0,0,0.2);
    }

    h2 { text-align: center; }

    .flex {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        justify-content: center;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        background: white;
    }

    th, td {
        border: 1px solid #ccc;
        padding: 10px;
        text-align: center;
    }

    th {
        background: #eee;
    }

    th.deleteCell, td.deleteCell {
        width: 40px;
        padding: 5px;
    }

    .deleteBtn {
        display: inline-block;
        width: 28px;
        height: 28px;
        line-height: 28px;
        border-radius: 50%;
        background: #ffdddd;
        border: 1px solid red;
        color: red;
        font-weight: bold;
        cursor: pointer;
        transition: 0.2s;
    }
    .deleteBtn:hover {
        background: red;
        color: white;
    }

    .panel {
        flex: 1;
        min-width: 300px;
    }

    #clock {
        font-size: 48px;
        font-weight: bold;
        text-align: center;
        margin-bottom: 20px;
    }

    #stopBtn {
        background: red;
        color: white;
        padding: 20px 40px;
        font-size: 28px;
        border: none;
        border-radius: 50px;
        cursor: pointer;
        display: block;
        margin: auto;
    }

    #stopBtn:active { transform: scale(0.95); }

    #stoppedTime {
        font-size: 28px;
        margin-top: 20px;
        text-align: center;
    }

    #winner {
        margin-top: 30px;
        padding: 20px;
        font-size: 24px;
        background: #d1ffd1;
        border-left: 5px solid green;
        display: none;
        text-align: center;
    }

    button.clear {
        margin-bottom: 10px;
        padding: 10px;
        background: #444;
        color: white;
        border: none;
        cursor: pointer;
        border-radius: 6px;
    }

    button.clear:hover {
        background: black;
    }

    /* ---- FAJERWERKI ---- */
    #fireworksCanvas {
        position: fixed;
        left: 0;
        top: 0;
        width: 100vw;
        height: 100vh;
        pointer-events: none;
        z-index: 9999;
        display: none;
    }

    /* ---- CRINGE GIFY ---- */
    #cringeGifs {
        position: fixed;
        bottom: 10px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 99999;
        display: none;
    }

    #cringeGifs img {
        height: 180px;
        margin: 5px;
        border-radius: 10px;
        box-shadow: 0 0 20px rgba(255,255,255,0.8);
    }

    /* migajƒÖce t≈Ço */
    @keyframes cringeBg {
        0% { background-color: #ff69b4; }
        25% { background-color: #00ffff; }
        50% { background-color: #ffff00; }
        75% { background-color: #ff00ff; }
        100% { background-color: #00ff00; }
    }

    /* migajƒÖca pierwsza osoba */
    @keyframes blinkGreen {
        0% { background-color: #d1ffd1; }
        50% { background-color: #00ff00; }
        100% { background-color: #d1ffd1; }
    }
    .blink {
        animation: blinkGreen 0.5s infinite;
    }
</style>
</head>

<body>
<div class="container">

<h2>Lista zapisanych os√≥b</h2>

<div class="flex">

    <!-- LEWA STRONA ‚Äì tabela -->
    <div class="panel">
        <button class="clear" onclick="clearAll()">Wyczy≈õƒá wszystkie dane</button>

        <table id="table">
            <tr>
                <th>Imiƒô</th>
                <th>Godzina</th>
                <th class="deleteCell">X</th>
            </tr>
        </table>
    </div>

    <!-- PRAWA STRONA ‚Äì zegar -->
    <div class="panel">
        <div id="clock">--:--:--</div>
        <button id="stopBtn">STOP</button>
        <div id="stoppedTime"></div>
    </div>

</div>

<div id="winner"></div>

</div>

<!-- Fajerwerki + cringe gify -->
<canvas id="fireworksCanvas"></canvas>
<div id="cringeGifs">
    <img src="https://media.giphy.com/media/3oz8xAFtqoOUUrsh7W/giphy.gif">
    <img src="https://media.giphy.com/media/l0ExncehJzexFpRHq/giphy.gif">
    <img src="https://media.giphy.com/media/xT5LMHxhOfscxPfIfm/giphy.gif">
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, collection, getDocs, deleteDoc, doc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCEEVCSx2uOOggu_4y_gUo4WMyKqf-HlKI",
  authDomain: "obstaiwanie.firebaseapp.com",
  projectId: "obstaiwanie",
  storageBucket: "obstaiwanie.firebasestorage.app",
  messagingSenderId: "64783465818",
  appId: "1:64783465818:web:0a9aa45acf40e351ae8763"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const table = document.getElementById("table");
let usersData = [];
let stoppedSeconds = null; // globalnie

// Automatyczna aktualizacja tabeli
onSnapshot(collection(db, "users"), (snapshot) => {
    usersData = [];
    snapshot.forEach((docu) => {
        const data = docu.data();
        usersData.push({ id: docu.id, ...data });
    });

    // je≈õli mamy zatrzymanƒÖ godzinƒô, sortuj wed≈Çug r√≥≈ºnicy
    if (stoppedSeconds !== null) {
        usersData.sort((a, b) => 
            Math.abs(toSeconds(a.hour) - stoppedSeconds) - Math.abs(toSeconds(b.hour) - stoppedSeconds)
        );
    }

    // aktualizacja tabeli
    table.innerHTML = `
        <tr>
            <th>Imiƒô</th>
            <th>Godzina</th>
            <th class="deleteCell">X</th>
        </tr>`;
    usersData.forEach((u, index) => {
        table.innerHTML += `
        <tr class="${index === 0 && stoppedSeconds !== null ? 'blink' : ''}">
            <td>${u.name}</td>
            <td>${u.hour}</td>
            <td class="deleteCell">
                <span class="deleteBtn" onclick="deleteOne('${u.id}')">X</span>
            </td>
        </tr>`;
    });
});

window.deleteOne = async function(id) {
    await deleteDoc(doc(db, "users", id));
};

window.clearAll = async function () {
    const snapshot = await getDocs(collection(db, "users"));
    snapshot.forEach(async (d) => {
        await deleteDoc(doc(db, "users", d.id));
    });
    stoppedSeconds = null;
    document.getElementById("stoppedTime").textContent = "";
    document.getElementById("winner").style.display = "none";
    document.getElementById("winner").textContent = "";
};

const clock = document.getElementById("clock");
setInterval(() => {
    const now = new Date();
    clock.textContent = now.toLocaleTimeString("pl-PL");
}, 1000);

document.getElementById("stopBtn").onclick = () => {
    const stopped = clock.textContent;
    document.getElementById("stoppedTime").textContent =
        "Zatrzymana godzina: " + stopped;
    if (usersData.length === 0) return;

    stoppedSeconds = toSeconds(stopped);

    usersData.sort((a, b) => 
        Math.abs(toSeconds(a.hour) - stoppedSeconds) - Math.abs(toSeconds(b.hour) - stoppedSeconds)
    );

    const best = usersData[0];

    const winner = document.getElementById("winner");
    winner.style.display = "block";
    winner.textContent = `üèÜ Zwyciƒôzca: ${best.name} (czas: ${best.hour})`;

    startFireworks();
};

function toSeconds(t) {
    const parts = t.split(":").map(Number);
    let h, m, s;
    if (parts.length === 3) {
        [h, m, s] = parts;
    } else if (parts.length === 2) {
        [h, m] = parts;
        s = 0;
    } else {
        return 0; 
    }
    re
