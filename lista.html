<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>Lista uÅ¼ytkownikÃ³w</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
/* ===== PODSTAWA ===== */
body {
    font-family: Arial, sans-serif;
    background: #f2f2f2;
    margin: 0;
    padding: 20px;
    display: flex;
    justify-content: center;
    transition: background-color 0.3s, color 0.3s;
}

.container {
    max-width: 1100px;
    width: 100%;
    background: white;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 0 25px rgba(0,0,0,0.3);
}

h2 {
    text-align: center;
}

/* ===== LAYOUT ===== */
.flex {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
}

.panel {
    flex: 1;
    min-width: 300px;
}

/* ===== TABELA ===== */
table {
    width: 100%;
    border-collapse: collapse;
    table-layout: fixed; /* ðŸ”¥ KLUCZ */
}

th, td {
    border: 1px solid #ccc;
    padding: 10px;
    text-align: center;
}

th {
    background: #eee;
}

/* ===== KOLUMNA X ===== */
th.deleteCell,
td.deleteCell {
    width: 60px;
    min-width: 60px;
    max-width: 60px;
}

.deleteBtn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 28px;
    height: 28px;
    border-radius: 50%;
    background: #ffdddd;
    border: 1px solid red;
    color: red;
    font-weight: bold;
    cursor: pointer;
}

/* ===== CLOCK / STOP ===== */
#clock {
    font-size: 48px;
    text-align: center;
    margin-bottom: 20px;
}

#stopBtn {
    background: red;
    color: white;
    padding: 20px 40px;
    font-size: 28px;
    border: none;
    border-radius: 50px;
    cursor: pointer;
}

button.clear {
    margin-bottom: 10px;
    padding: 10px;
    background: #444;
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
}

/* ===== MIGANIE ===== */
@keyframes blinkLight {
    0% { background-color: #d1ffd1; }
    50% { background-color: #006400; }
    100% { background-color: #d1ffd1; }
}

@keyframes blinkDark {
    0% { background-color: #003300; }
    50% { background-color: #00cc00; }
    100% { background-color: #003300; }
}

/* ðŸ”¥ animujemy TD */
tr.blink td {
    animation: blinkLight 1.5s infinite;
    color: white;
    font-weight: bold;
}

/* ===== DARK MODE ===== */
body.dark {
    background: #121212;
    color: #eee;
}

body.dark .container {
    background: #1e1e1e;
}

body.dark th {
    background: #2a2a2a;
    color: white;
}

body.dark td {
    background: #1e1e1e;
    color: #ddd;
}

body.dark tr.blink td {
    animation: blinkDark 1.5s infinite;
    color: #eaffea;
}

body.dark .deleteBtn {
    background: #550000;
    border-color: #ff5555;
    color: #ff5555;
}

body.dark #stopBtn {
    background: #b30000;
}

/* ===== SUWAK ===== */
.theme-switch {
    position: fixed;
    top: 15px;
    right: 15px;
    z-index: 100000;
}

.theme-switch input {
    display: none;
}

.slider {
    width: 50px;
    height: 26px;
    background: #ccc;
    border-radius: 26px;
    position: relative;
    cursor: pointer;
}

.slider::before {
    content: "";
    position: absolute;
    width: 22px;
    height: 22px;
    background: white;
    border-radius: 50%;
    top: 2px;
    left: 2px;
    transition: transform 0.3s;
}

input:checked + .slider {
    background: #4caf50;
}

input:checked + .slider::before {
    transform: translateX(24px);
}
</style>
</head>

<body>

<!-- SUWAK -->
<label class="theme-switch">
    <input type="checkbox" id="themeToggle">
    <span class="slider"></span>
</label>

<div class="container">
<h2>Lista zapisanych osÃ³b</h2>

<div class="flex">

<div class="panel">
<button class="clear" onclick="clearAll()">WyczyÅ›Ä‡ wszystkie dane</button>

<table id="table">
<tr>
<th>No.</th>
<th>ImiÄ™</th>
<th>Godzina</th>
<th class="deleteCell">X</th>
</tr>
</table>
</div>

<div class="panel">
<div id="clock">--:--:--</div>
<button id="stopBtn">STOP</button>
</div>

</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, collection, getDocs, deleteDoc, doc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCEEVCSx2uOOggu_4y_gUo4WMyKqf-HlKI",
  authDomain: "obstaiwanie.firebaseapp.com",
  projectId: "obstaiwanie",
  storageBucket: "obstaiwanie.firebasestorage.app",
  messagingSenderId: "64783465818",
  appId: "1:64783465818:web:0a9aa45acf40e351ae8763"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const table = document.getElementById("table");
let usersData = [];

onSnapshot(collection(db,"users"), snap=>{
    usersData=[];
    snap.forEach(d=>usersData.push({id:d.id,...d.data()}));
});

function toSeconds(t){
    const p=t.split(":").map(Number);
    return (p[0]||0)*3600+(p[1]||0)*60+(p[2]||0);
}

setInterval(()=>{
    const now=new Date();
    document.getElementById("clock").textContent=now.toLocaleTimeString("pl-PL");

    const cur=now.getHours()*3600+now.getMinutes()*60+now.getSeconds();
    const sorted=[...usersData].sort(
        (a,b)=>Math.abs(toSeconds(a.hour)-cur)-Math.abs(toSeconds(b.hour)-cur)
    );

    table.innerHTML=`
    <tr>
        <th>No.</th>
        <th>ImiÄ™</th>
        <th>Godzina</th>
        <th class="deleteCell">X</th>
    </tr>`;

    sorted.forEach((u,i)=>{
        table.innerHTML+=`
        <tr class="${i===0?'blink':''}">
            <td>${i+1}</td>
            <td>${u.name}</td>
            <td>${u.hour}</td>
            <td class="deleteCell">
                <span class="deleteBtn" onclick="deleteOne('${u.id}')">X</span>
            </td>
        </tr>`;
    });
},1000);

window.deleteOne=id=>deleteDoc(doc(db,"users",id));

window.clearAll=async()=>{
    const s=await getDocs(collection(db,"users"));
    s.forEach(d=>deleteDoc(doc(db,"users",d.id)));
};

/* ===== DARK MODE ===== */
const toggle=document.getElementById("themeToggle");
if(localStorage.getItem("theme")==="dark"){
    document.body.classList.add("dark");
    toggle.checked=true;
}
toggle.onchange=()=>{
    document.body.classList.toggle("dark");
    localStorage.setItem("theme",toggle.checked?"dark":"light");
};
</script>

</body>
</html>
